<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Archlord Items Catalog</title>
    <link rel="icon" href="images/human_icon.png" type="image/png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 24px;">
            <img src="images/ArchLord_Logo.png" alt="Logo" class="logo">
        </div>
        <div class="filter-section">
            <label for="item-type-filter">Filter results:</label>
            <select id="item-type-filter">
                <option value="All">All</option>
            </select>
            <!-- Dodane pole wyszukiwania po nazwie -->
            <input type="text" id="item-name-search" placeholder="Wpisz nazwę przedmiotu">
            <button id="item-name-search-btn">Search</button>
        </div>

        <div id="items-container" class="items-grid">
            </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const itemsContainer = document.getElementById('items-container');
            const itemTypeFilter = document.getElementById('item-type-filter');
            const itemNameSearch = document.getElementById('item-name-search');
            const itemNameSearchBtn = document.getElementById('item-name-search-btn');
            let itemsData = []; // Tutaj będziemy przechowywać wszystkie wczytane dane

            // Funkcja do wczytywania danych z JSON
            async function fetchItems() {
                try {
                    const response = await fetch('items.JSON');
                    if (!response.ok) {
                        throw new Error(`Błąd HTTP! Status: ${response.status}`);
                    }
                    itemsData = await response.json();
                    populateFilter();
                    displayItems(itemsData);
                } catch (error) {
                    console.error('Nie udało się wczytać danych przedmiotów:', error);
                    itemsContainer.innerHTML = '<p>Wystąpił błąd podczas ładowania przedmiotów. Spróbuj ponownie później.</p>';
                }
            }

            // Funkcja do wypełniania filtra rodzajów
            function populateFilter() {
                const uniqueTypes = new Set(itemsData.map(item => item.rodzaj));
                uniqueTypes.forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    itemTypeFilter.appendChild(option);
                });
            }

            // Funkcja mapująca unikalność na kolor
            function getUniquenessColor(unikalnosc) {
                const colorMap = {
                    1: '#fbe9b9',
                    2: '#afa87c',
                    3: '#6bcfff',
                    4: '#ffffff',
                    5: '#7344a2',
                    6: '#ffff00',
                    7: '#18d0f6',
                    8: '#00ff00',
                    9: '#1e90ff'
                };
                return colorMap[unikalnosc] || '#ffffff';
            }

            // Funkcja do wyświetlania przedmiotów
            function displayItems(itemsToDisplay) {
                itemsContainer.innerHTML = ''; // Wyczyść kontener przed dodaniem nowych przedmiotów
                if (itemsToDisplay.length === 0) {
                    itemsContainer.innerHTML = '<p>Brak przedmiotów do wyświetlenia dla wybranego filtru.</p>';
                    return;
                }

                itemsToDisplay.forEach(item => {
                    const itemTile = document.createElement('div');
                    itemTile.classList.add('item-tile');

                    itemTile.innerHTML = `
                        <img src="${item.obrazek}" alt="${item.nazwa}" class="item-image">
                        <h3 class="item-name" style="color: ${getUniquenessColor(item.unikalnosc)}">${item.nazwa}</h3>
                        <p class="item-id">Item Id: <span>${item.itemId}</span></p>
                        <p class="item-type">Item type: <span>${item.rodzaj}</span></p>
                        <p class="item-uniqueness">Rarity: <span>${item.unikalnosc}</span></p>
                        <p class="item-description">${item.opis}</p>
                    `;
                    itemsContainer.appendChild(itemTile);
                });
            }

            // Obsługa zmiany filtra typu
            itemTypeFilter.addEventListener('change', (event) => {
                const selectedType = event.target.value;
                let filteredItems = itemsData;
                if (selectedType !== 'All') {
                    filteredItems = filteredItems.filter(item => item.rodzaj === selectedType);
                }
                displayItems(filteredItems);
            });

            // Obsługa wyszukiwania po nazwie
            itemNameSearchBtn.addEventListener('click', () => {
                const searchPhrase = itemNameSearch.value.trim().toLowerCase();
                let filteredItems = itemsData;
                if (searchPhrase.length > 0) {
                    filteredItems = filteredItems.filter(item =>
                        item.nazwa.toLowerCase().includes(searchPhrase)
                    );
                }
                displayItems(filteredItems);
            });

            // Wczytaj przedmioty po załadowaniu strony
            fetchItems();
        });
    </script>
</body>
</html>